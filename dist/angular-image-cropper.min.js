!function(t){"use strict";t.module("imageCropper",[])}(angular),function(t){"use strict";t.module("imageCropper").constant("defaultConfig",{width:400,height:300,zoomStep:.1,init:null,showControls:!0,fitOnInit:!0,restrictSize:!1})}(angular),function(t){"use strict";function e(t){function e(t){return r.test(t.type)}function i(t){return e(t)?1===t.originalEvent.changedTouches.length:1===t.which}function n(t){return e(t)&&(t=t.originalEvent.touches[0]),{x:t.pageX,y:t.pageY}}function o(){if(null!==a)return a;var t,e,i,n,o,r,l,s,u;for(i=["webkit","Moz","O","ms","Khtml"],r={transform:"transform"},s=0,u=i.length;u>s;s++)e=i[s],r[e+"Transform"]="-"+e.toLowerCase()+"-transform";t=document.createElement("img"),document.body.insertBefore(t,null);for(o in r)if(n=r[o],void 0!==t.style[o]&&(t.style[o]="rotate(90deg)",l=window.getComputedStyle(t).getPropertyValue(n),null!==l&&l.length&&"none"!==l)){a=!0;break}return document.body.removeChild(t),a}var r=/touch/i,a=null,l={canTransform:o,getPointerPosition:n,isTouch:e,validEvent:i};return l}t.module("imageCropper").factory("Helper",e),e.$inject=["defaultConfig"]}(angular),function(t){"use strict";function e(t,e){function i(t,i,o,u){return r=document.createElement("canvas"),r.width=o,r.height=u,a=r.getContext("2d"),a.fillStyle="white",a.beginPath(),a.fillStyle="white",a.moveTo(0,0),a.lineTo(o,0),a.lineTo(o,u),a.lineTo(0,u),a.lineTo(0,0),a.stroke(),a.fill(),s=i,c=e.defer(),l=new Image,l.src=t.src,l.onload=n,c.promise}function n(){return a.save(),a.scale(s.scale,s.scale),a.rotate(s.angle*Math.PI/180),90===s.angle?(a.translate(0,-l.height),a.translate(-s.y/s.scale,s.x/s.scale)):180===s.angle?(a.translate(-l.width,-l.height),a.translate(s.x/s.scale,s.y/s.scale)):270===s.angle?(a.translate(-l.width,0),a.translate(s.y/s.scale,-s.x/s.scale)):a.translate(-s.x/s.scale,-s.y/s.scale),a.drawImage(l,0,0),a.restore(),u=r.toDataURL("image/jpeg"),c.resolve(u)}function o(){return u}var r,a,l,s,u,c,d={crop:i,get:o};return d}t.module("imageCropper").factory("Cropper",e),e.$inject=["Helper","$q"]}(angular),function(t){"use strict";function e(e,i,n){function o(o,r,a){var l=!1,s=t.element("body"),u=r.find("img"),c=r.find(".imgCropper-canvas"),d=r.find(".imgCropper-window"),g={};g.width=Number(o.destWidth)||i.width,g.height=Number(o.destHeight)||i.height,g.zoomStep=Number(o.zoomStep)||i.zoomStep,g.init=o.init||i.init,g.fitOnInit=o.fitOnInit||i.fitOnInit,g.restrictSize=o.restrictSize||i.restrictSize;var h,f,p,m,v,w=1+g.zoomStep,y=1/w,b=g.height/g.width;h=f=p=m=v=0;var S,x={scale:1,angle:0,x:0,y:0,w:g.width,h:g.height},k={start:"touchstart mousedown",move:"touchmove mousemove",stop:"touchend mouseup"},C=function(){h=u[0].naturalWidth/g.width,f=u[0].naturalHeight/g.height,c.css({width:100*h+"%",height:100*f+"%",top:0,left:0}),d.css({width:"100%",height:"auto","padding-top":g.height/g.width*100+"%"}),l=!0},z=function(t){return l&&n.validEvent(t)?(t.preventDefault(),t.stopImmediatePropagation(),S=n.getPointerPosition(t),$()):void 0},$=function(){return s.addClass("imgCropper-dragging"),c.on(k.move,O),c.on(k.stop,I)},I=function(t){s.removeClass("imgCropper-dragging"),c.off(k.move,O),c.off(k.stop,I)},F=function(t,e){if(!(0>t&&g.restrictSize)){if(t||0===t){console.log(t);var i=1;0>t&&(i=.5,t=0),t>h-1&&(t=h-1),c[0].style.left=(-t*i*100).toFixed(2)+"%",p=t*i,console.log(p),x.x=Math.round(t*i*g.width)}if(e||0===e){var n=1;0>e&&(n=.5,e=0),e>f-1&&(e=f-1),c[0].style.top=(-e*n*100).toFixed(2)+"%",m=e*n,x.y=Math.round(e*n*g.height)}return _()}},O=function(t){var e,i,o,r,a;return t.preventDefault(),t.stopImmediatePropagation(),r=n.getPointerPosition(t),e=r.x-S.x,i=r.y-S.y,S=r,o=0===e?null:p-e/d[0].clientWidth,a=0===i?null:m-i/d[0].clientHeight,F(o,a)},P=function(t){var e,i,n,o,r=x.scale*t;return.5>r||r>2||0>=t||1===t?void 0:(o=h,e=f,(1>o*t||1>e*t)&&g.restrictSize?(E(),t=h/o):(h*=t,f*=t,c[0].style.width=(100*h).toFixed(2)+"%",c[0].style.height=(100*f).toFixed(2)+"%",x.scale*=t),i=(p+.5)*t-.5,n=(m+.5)*t-.5,F(i,n))},H=function(t,e,i,n){var o,r,a,l;return o=h,r=f/h,u[0].naturalWidth>g.width?r>1?(h=1,f=r):(h=1/r,f=1):(h=u[0].naturalWidth/g.width,f=u[0].naturalHeight/g.height),h*=t,f*=t,c[0].style.width=(100*h).toFixed(2)+"%",c[0].style.height=(100*f).toFixed(2)+"%",x.scale=t,a=(p+.5)*e-.5,l=(m+.5)*e-.5,F(a,l)},E=function(){var t,e;return t=h,e=f/h,u[0].naturalWidth>g.width?e>1?(h=1,f=e):(h=1/e,f=1):(h=u[0].naturalWidth/g.width,f=u[0].naturalHeight/g.height),c[0].style.width=(100*h).toFixed(2)+"%",c[0].style.height=(100*f).toFixed(2)+"%",x.scale*=h/t,_()},T=function(){return F((h-1)/2,(f-1)/2)},W=function(t){var e,i,o,r,a,l;if(n.canTransform()&&0!==t&&t%90===0)return v=(v+t)%360,0>v&&(v=360+v),t%180!==0&&(r=[f*b,h/b],h=r[0],f=r[1],h>=1&&f>=1?(c[0].style.width=100*h+"%",c[0].style.height=100*f+"%"):E()),a=[1,1],o=a[0],i=a[1],v%180!==0&&(e=f/h*b,l=[e,1/e],o=l[0],i=l[1]),u[0].style.width=100*o+"%",u[0].style.height=100*i+"%",u[0].style.left=(1-o)/2*100+"%",u[0].style.top=(1-i)/2*100+"%",u.css({transform:"rotate("+v+"deg)"}),T(),x.angle=v,_()};o.rotateLeft=function(){W(-90)},o.rotateRight=function(){W(90)},o.center=function(){T()},o.sliderChange=function(t){var e;1==t?(E(),T()):(e=1>t?w:y,H(t,e,o.OrgWidth,o.OrgHeight))},o.fit=function(){E(),T()},o.zoomIn=function(){P(w)},o.zoomOut=function(){P(y),_()};var _=function(){e.crop(u[0],x,g.width,g.height).then(function(t){o.croppedImage=t})};u[0].onload=function(){var t=this;C(),M(u),o.OrgHeight=t.naturalHeight,o.OrgWidth=t.naturalWidth,(t.naturalWidth<g.width||t.naturalHeight<g.height||g.fitOnInit)&&E(),T(),r.find("img").on(k.start,z),_()};var M=function(e){return t.element(e).css({"-webkit-perspective":1e3,perspective:1e3,"-webkit-backface-visibility":"hidden","backface-visibility":"hidden"})}}return{restrict:"E",scope:{image:"@",destWidth:"@",destHeight:"@",zoomStep:"@",init:"@",croppedImage:"=",showControls:"=",fitOnInit:"=",restrictSize:"=",currentScale:"@",minSize:"=",maxSize:"="},template:['<div class="frame">','<div class="imgCropper-window">','<div class="imgCropper-canvas">','<img ng-src="{{image}}">',"</div></div></div>",'<div id="controls" ng-if="showControls">','<button ng-click="rotateLeft()" type="button" title="Rotate left"> &lt; </button>','<button ng-click="zoomOut()" type="button" title="Zoom out"> - </button>','<button ng-click="fit()" type="button" title="Fit image"> [ ] </button>','<slider ng-model="currentScale" on-stop-slide="sliderChange(currentScale)" min="minSize" step="0.1" max="maxSize" value="currentScale" tooltip="hide"></slider>','<button ng-click="zoomIn()" type="button" title="Zoom in"> + </button>','<button ng-click="rotateRight()" type="button" title="Rotate right"> &gt; </button>',"</div>"].join(""),link:o}}t.module("imageCropper").directive("imageCropper",e),e.$inject=["Cropper","defaultConfig","Helper"]}(angular),angular.module("ui.bootstrap-slider",[]).directive("slider",["$parse","$timeout","$rootScope",function(t,e,i){return{restrict:"AE",replace:!0,template:'<div><input class="slider-input" type="text" style="width:100%" /></div>',require:"ngModel",scope:{max:"=",min:"=",step:"=",value:"=",ngModel:"=",ngDisabled:"=",range:"=",sliderid:"=",ticks:"=",ticksLabels:"=",ticksSnapBounds:"=",ticksPositions:"=",scale:"=",focus:"=",formatter:"&",onStartSlide:"&",onStopSlide:"&",onSlide:"&"},link:function(e,i,n,o,r){function a(){function r(t,e,i){d[t]=e||i}function a(t,e,i){d[t]=e||0===e?parseFloat(e):i}function u(t,e,i){d[t]=e?e+""=="true":i}function c(t){return angular.isString(t)&&0===t.indexOf("[")?angular.fromJson(t):t}var d={};r("id",e.sliderid),r("orientation",n.orientation,"horizontal"),r("selection",n.selection,"before"),r("handle",n.handle,"round"),r("tooltip",n.sliderTooltip||n.tooltip,"show"),r("tooltip_position",n.sliderTooltipPosition,"top"),r("tooltipseparator",n.tooltipseparator,":"),r("ticks",e.ticks),r("ticks_labels",e.ticksLabels),r("ticks_snap_bounds",e.ticksSnapBounds),r("ticks_positions",e.ticksPositions),r("scale",e.scale,"linear"),r("focus",e.focus),a("min",e.min,0),a("max",e.max,10),a("step",e.step,1);var g=d.step+"",h=g.search(/[^.,]*$/),f=g.substring(h);if(a("precision",n.precision,f.length),u("tooltip_split",n.tooltipsplit,!1),u("enabled",n.enabled,!0),u("naturalarrowkeys",n.naturalarrowkeys,!1),u("reversed",n.reversed,!1),u("range",e.range,!1),d.range){if(angular.isArray(e.value))d.value=e.value;else if(angular.isString(e.value)){if(d.value=c(e.value),!angular.isArray(d.value)){var p=parseFloat(e.value);isNaN(p)&&(p=5),p<e.min?(p=e.min,d.value=[p,d.max]):p>e.max?(p=e.max,d.value=[d.min,p]):d.value=[d.min,d.max]}}else d.value=[d.min,d.max];e.ngModel=d.value}else a("value",e.value,5);n.formatter&&(d.formatter=function(t){return e.formatter({value:t})}),"$"in window&&$.fn.slider&&($.fn.slider.constructor.prototype.disable=function(){this.picker.off()},$.fn.slider.constructor.prototype.enable=function(){this.picker.on()}),i[0].__slider&&i[0].__slider.destroy();var m=new Slider(i[0].getElementsByClassName("slider-input")[0],d);i[0].__slider=m;var v=c(n.updateevent);v=angular.isString(v)?[v]:["slide"],angular.forEach(v,function(t){m.on(t,function(t){o.$setViewValue(t)})}),m.on("change",function(t){o.$setViewValue(t.newValue)});var w={slideStart:"onStartSlide",slide:"onSlide",slideStop:"onStopSlide"};return angular.forEach(w,function(i,o){var r=t(n[i]);m.on(o,function(t){e[i]&&r(e.$parent,{$event:t,value:t})})}),angular.isFunction(s)&&(s(),s=null),s=e.$watch("ngDisabled",function(t){t?m.disable():m.enable()}),angular.isFunction(l)&&l(),l=e.$watch("ngModel",function(t){e.range?m.setValue(t):m.setValue(parseFloat(t)),m.relayout()},!0),m}var l,s,u=a(),c=["min","max","step","range","scale"];angular.forEach(c,function(t){e.$watch(t,function(){u=a()})}),e.$on("slider:relayout",function(){u.relayout()})}}}]);