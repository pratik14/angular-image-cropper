!function(e){"use strict";e.module("imageCropper",[])}(angular),function(e){"use strict";e.module("imageCropper").constant("defaultConfig",{width:400,height:300,zoomStep:.1,init:null,showControls:!0,fitOnInit:!0,restrictSize:!1})}(angular),function(e){"use strict";function t(e){function t(e){return o.test(e.type)}function i(e){return t(e)?1===e.originalEvent.changedTouches.length:1===e.which}function n(e){return t(e)&&(e=e.originalEvent.touches[0]),{x:e.pageX,y:e.pageY}}function r(){if(null!==a)return a;var e,t,i,n,r,o,l,s,u;for(i=["webkit","Moz","O","ms","Khtml"],o={transform:"transform"},s=0,u=i.length;u>s;s++)t=i[s],o[t+"Transform"]="-"+t.toLowerCase()+"-transform";e=document.createElement("img"),document.body.insertBefore(e,null);for(r in o)if(n=o[r],void 0!==e.style[r]&&(e.style[r]="rotate(90deg)",l=window.getComputedStyle(e).getPropertyValue(n),null!==l&&l.length&&"none"!==l)){a=!0;break}return document.body.removeChild(e),a}var o=/touch/i,a=null,l={canTransform:r,getPointerPosition:n,isTouch:t,validEvent:i};return l}e.module("imageCropper").factory("Helper",t),t.$inject=["defaultConfig"]}(angular),function(e){"use strict";function t(e,t){function i(e,i,r,u){return o=document.createElement("canvas"),o.width=r,o.height=u,a=o.getContext("2d"),a.fillStyle="white",a.beginPath(),a.fillStyle="white",a.moveTo(0,0),a.lineTo(r,0),a.lineTo(r,u),a.lineTo(0,u),a.lineTo(0,0),a.stroke(),a.fill(),s=i,c=t.defer(),l=new Image,l.src=e.src,l.onload=n,c.promise}function n(){return a.save(),a.scale(s.scale,s.scale),a.rotate(s.angle*Math.PI/180),90===s.angle?(a.translate(0,-l.height),a.translate(-s.y/s.scale,s.x/s.scale)):180===s.angle?(a.translate(-l.width,-l.height),a.translate(s.x/s.scale,s.y/s.scale)):270===s.angle?(a.translate(-l.width,0),a.translate(s.y/s.scale,-s.x/s.scale)):a.translate(-s.x/s.scale,-s.y/s.scale),a.drawImage(l,0,0),a.restore(),u=o.toDataURL("image/jpeg"),c.resolve(u)}function r(){return u}var o,a,l,s,u,c,d={crop:i,get:r};return d}e.module("imageCropper").factory("Cropper",t),t.$inject=["Helper","$q"]}(angular),function(e){"use strict";function t(t,i,n){function r(r,o,a){var l=!1,s=e.element("body"),u=o.find("img"),c=o.find(".imgCropper-canvas"),d=o.find(".imgCropper-window"),f={};f.width=Number(r.destWidth)||i.width,f.height=Number(r.destHeight)||i.height,f.zoomStep=Number(r.zoomStep)||i.zoomStep,f.init=r.init||i.init,f.fitOnInit=r.fitOnInit||i.fitOnInit,r.storedValue=r.currentScale;var g,h,p,m,v,w=1+f.zoomStep,y=1/w,S=f.height/f.width;g=h=p=m=v=0;var x,b={scale:1,angle:0,x:0,y:0,w:f.width,h:f.height},C={start:"touchstart mousedown",move:"touchmove mousemove",stop:"touchend mouseup"},k=function(){g=u[0].naturalWidth/f.width,h=u[0].naturalHeight/f.height,c.css({width:100*g+"%",height:100*h+"%",top:0,left:0}),d.css({width:"100%",height:"auto","padding-top":f.height/f.width*100+"%"}),l=!0},z=function(e){return l&&n.validEvent(e)?(e.preventDefault(),e.stopImmediatePropagation(),x=n.getPointerPosition(e),$()):void 0},$=function(){return s.addClass("imgCropper-dragging"),c.on(C.move,E),c.on(C.stop,F)},F=function(e){s.removeClass("imgCropper-dragging"),c.off(C.move,E),c.off(C.stop,F)},I=function(e){if(r.storedValue!=e){r.storedValue=e;var t=e/b.scale;T(t),O()}},P=function(e,t){if(e||0===e){var i=1;0>e&&(i=.5,e=0),e>g-1&&(e=g-1),c[0].style.left=(-e*i*100).toFixed(2)+"%",p=e*i,b.x=Math.round(e*i*f.width)}if(t||0===t){var n=1;0>t&&(n=.5,t=0),t>h-1&&(t=h-1),c[0].style.top=(-t*n*100).toFixed(2)+"%",m=t*n,b.y=Math.round(t*n*f.height)}return O()},E=function(e){var t,i,r,o,a;return e.preventDefault(),e.stopImmediatePropagation(),o=n.getPointerPosition(e),t=o.x-x.x,i=o.y-x.y,x=o,r=0===t?null:p-t/d[0].clientWidth,a=0===i?null:m-i/d[0].clientHeight,P(r,a)},T=function(e){var t,i,n,o,a;return a=(b.scale*e).toFixed(1),a<r.minSize||a>r.maxSize||0>=e||1===e?void 0:(o=g,t=h,g*=e,h*=e,c[0].style.width=(100*g).toFixed(2)+"%",c[0].style.height=(100*h).toFixed(2)+"%",b.scale*=e,r.currentScale=b.scale.toFixed(1),i=(p+.5)*e-.5,n=(m+.5)*e-.5,P(i,n))},_=function(){var e,t,i;if(e=g,t=h/g,u[0].naturalWidth>f.width&&u[0].naturalHeight>f.height)i=t>1?1/e:1/(e*t),i<r.minSize?(g=e*r.minSize,h*=r.minSize):t>1?(g=1,h=t):(g=1/t,h=1);else{g=u[0].naturalWidth/f.width,h=u[0].naturalHeight/f.height;var n;n=t>1?f.height/u[0].naturalHeight:f.width/u[0].naturalWidth,g*=n,h*=n}return c[0].style.width=(100*g).toFixed(2)+"%",c[0].style.height=(100*h).toFixed(2)+"%",b.scale*=g/e,r.currentScale=b.scale.toFixed(1),O()},H=function(){return P((g-1)/2,(h-1)/2)},V=function(e){var t,i,r,o,a,l;if(n.canTransform()&&0!==e&&e%90===0)return v=(v+e)%360,0>v&&(v=360+v),e%180!==0&&(o=[h*S,g/S],g=o[0],h=o[1],g>=1&&h>=1?(c[0].style.width=100*g+"%",c[0].style.height=100*h+"%"):_()),a=[1,1],r=a[0],i=a[1],v%180!==0&&(t=h/g*S,l=[t,1/t],r=l[0],i=l[1]),u[0].style.width=100*r+"%",u[0].style.height=100*i+"%",u[0].style.left=(1-r)/2*100+"%",u[0].style.top=(1-i)/2*100+"%",u.css({transform:"rotate("+v+"deg)"}),H(),b.angle=v,O()};r.rotateLeft=function(){V(-90)},r.rotateRight=function(){V(90)},r.center=function(){H()},r.sliderChange=function(e){I(e)},r.fit=function(){_(),H()},r.zoomIn=function(){T(w),O()},r.zoomOut=function(){T(y),O()};var O=function(){t.crop(u[0],b,f.width,f.height).then(function(e){r.croppedImage=e})};u[0].onload=function(){var e=this;k(),M(u),(e.naturalWidth<f.width||e.naturalHeight<f.height||f.fitOnInit)&&_(),H(),o.find("img").on(C.start,z),O()};var M=function(t){return e.element(t).css({"-webkit-perspective":1e3,perspective:1e3,"-webkit-backface-visibility":"hidden","backface-visibility":"hidden"})}}return{restrict:"E",scope:{image:"@",destWidth:"@",destHeight:"@",zoomStep:"@",init:"@",croppedImage:"=",showControls:"=",fitOnInit:"=",restrictSize:"=",currentScale:"=",minSize:"=",maxSize:"="},template:['<div class="frame">','<div class="imgCropper-window">','<div class="imgCropper-canvas">','<img ng-src="{{image}}">',"</div></div></div>",'<div id="controls" ng-if="showControls">','<slider class="zoomslider-wrap" ng-model="currentScale" on-slide="sliderChange(currentScale)" min="minSize" step="0.01" max="maxSize" value="currentScale"></slider>',"</div>"].join(""),link:r}}e.module("imageCropper").directive("imageCropper",t),t.$inject=["Cropper","defaultConfig","Helper"]}(angular),angular.module("ui.bootstrap-slider",[]).directive("slider",["$parse","$timeout","$rootScope",function(e,t,i){return{restrict:"AE",replace:!0,template:'<div><input class="slider-input" type="text" style="width:100%" /></div>',require:"ngModel",scope:{max:"=",min:"=",step:"=",value:"=",ngModel:"=",ngDisabled:"=",range:"=",sliderid:"=",ticks:"=",ticksLabels:"=",ticksSnapBounds:"=",ticksPositions:"=",scale:"=",focus:"=",formatter:"&",onStartSlide:"&",onStopSlide:"&",onSlide:"&"},link:function(t,i,n,r,o){function a(){function o(e,t,i){d[e]=t||i}function a(e,t,i){d[e]=t||0===t?parseFloat(t):i}function u(e,t,i){d[e]=t?t+""=="true":i}function c(e){return angular.isString(e)&&0===e.indexOf("[")?angular.fromJson(e):e}var d={};o("id",t.sliderid),o("orientation",n.orientation,"horizontal"),o("selection",n.selection,"before"),o("handle",n.handle,"round"),o("tooltip",n.sliderTooltip||n.tooltip,"show"),o("tooltip_position",n.sliderTooltipPosition,"top"),o("tooltipseparator",n.tooltipseparator,":"),o("ticks",t.ticks),o("ticks_labels",t.ticksLabels),o("ticks_snap_bounds",t.ticksSnapBounds),o("ticks_positions",t.ticksPositions),o("scale",t.scale,"linear"),o("focus",t.focus),a("min",t.min,0),a("max",t.max,10),a("step",t.step,1);var f=d.step+"",g=f.search(/[^.,]*$/),h=f.substring(g);if(a("precision",n.precision,h.length),u("tooltip_split",n.tooltipsplit,!1),u("enabled",n.enabled,!0),u("naturalarrowkeys",n.naturalarrowkeys,!1),u("reversed",n.reversed,!1),u("range",t.range,!1),d.range){if(angular.isArray(t.value))d.value=t.value;else if(angular.isString(t.value)){if(d.value=c(t.value),!angular.isArray(d.value)){var p=parseFloat(t.value);isNaN(p)&&(p=5),p<t.min?(p=t.min,d.value=[p,d.max]):p>t.max?(p=t.max,d.value=[d.min,p]):d.value=[d.min,d.max]}}else d.value=[d.min,d.max];t.ngModel=d.value}else a("value",t.value,5);n.formatter&&(d.formatter=function(e){return t.formatter({value:e})}),"$"in window&&$.fn.slider&&($.fn.slider.constructor.prototype.disable=function(){this.picker.off()},$.fn.slider.constructor.prototype.enable=function(){this.picker.on()}),i[0].__slider&&i[0].__slider.destroy();var m=new Slider(i[0].getElementsByClassName("slider-input")[0],d);i[0].__slider=m;var v=c(n.updateevent);v=angular.isString(v)?[v]:["slide"],angular.forEach(v,function(e){m.on(e,function(e){r.$setViewValue(e)})}),m.on("change",function(e){r.$setViewValue(e.newValue)});var w={slideStart:"onStartSlide",slide:"onSlide",slideStop:"onStopSlide"};return angular.forEach(w,function(i,r){var o=e(n[i]);m.on(r,function(e){t[i]&&o(t.$parent,{$event:e,value:e})})}),angular.isFunction(s)&&(s(),s=null),s=t.$watch("ngDisabled",function(e){e?m.disable():m.enable()}),angular.isFunction(l)&&l(),l=t.$watch("ngModel",function(e){t.range?m.setValue(e):m.setValue(parseFloat(e)),m.relayout()},!0),m}var l,s,u=a(),c=["min","max","step","range","scale"];angular.forEach(c,function(e){t.$watch(e,function(){u=a()})}),t.$on("slider:relayout",function(){u.relayout()})}}}]);